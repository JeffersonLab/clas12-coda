Registers:
  version: '1.2'
  warning: |
    ***************************************************************************
    ***************************************************************************
    ***************************************************************************
    ***************************************************************************
    ***************************************************************************
    DO NOT EDIT THIS FILE

    This file was generated from template '{{ metadata.template }}'
    and register map {{ metadata.config }}, version {{ tree.version }}
    by the script '{{ metadata.name }}', version: {{ metadata.version }},
    using the following commandline:

    {{ metadata.cmdline }}

    Please do NOT edit this file, but edit the source file at '{{ metadata.template }}'

    ***************************************************************************
    ***************************************************************************
    ***************************************************************************
    ***************************************************************************
    ***************************************************************************

  type: R
  step: 0x010
  default: 0
  endpoints: 0,1
  entries:
    - ref: Bar0
      offset: 0x0000
    - ref: Bar1
      offset: 0x0000
    - ref: Bar2
      offset: 0x0000
    - ref: Monitorsections
      offset: 0x0000
    
Monitorsections:
  endpoints: 0,1
  entries:
    - name: GenericBoardInformation
      record_name: register_map_gen_board_info
      bitfield: 
        - range: 0..0
          type: R
    - name: fee_reply 
      record_name: register_map_fee_reply
      bitfield: 
        - range: 0..0
          type: R
    - name: fee_link_counters
      record_name: register_map_fee_link_counters
      bitfield: 
        - range: 0..0
          type: R
    - name: gth_status 
      record_name: register_map_gth_status
      bitfield: 
        - range: 0..0
          type: R
    - name: evt_stat
      record_name: register_map_evt_stat
      bitfield:
        - range: 0..0
          type: R

#Bar0 contains the registers dedicated to Wupper. Please only edit registers in Bar2
#Registers in this group will not be generated with WupperCodeGen
Bar0:
  endpoints: 0,1
  entries:
    - ref: DMA_DESC
    - ref: DMA_DESC_STATUS
      offset: 0x0200
    - name: BAR0_VALUE
      offset: 0x0300
      bitfield:
        - range: 31..0
          desc: Copy of BAR0 offset reg.
    - name: BAR1_VALUE
      bitfield:
        - range: 31..0
          desc: Copy of BAR1 offset reg.
    - name: BAR2_VALUE
      bitfield:
        - range: 31..0
          desc: Copy of BAR2 offset reg.
    - name: DMA_DESC_ENABLE
      offset: 0x0400
      bitfield:
        - range: 7..0
          type: W
          desc: Enable descriptors 7:0. One bit per descriptor. Cleared when Descriptor is handled.
    - name: DMA_FIFO_FLUSH
      type: T
      bitfield:
        - range: any
          desc: Flush (reset). Any write clears the DMA Main output FIFO
    - name: DMA_RESET
      type: T
      bitfield:
        - range: any
          desc: Reset Wupper Core (DMA Controller FSMs)
    - name: SOFT_RESET
      type: T
      bitfield:
        - range: any
          desc: Global Software Reset. Any write resets applications, e.g. the Central Router.
    - name: REGISTER_RESET
      type: T
      bitfield:
        - range: any
          desc: Resets the register map to default values. Any write triggers this reset.
    - name: FROMHOST_FULL_THRESH
      type: W
      bitfield:
        - range: 22..16
          name: THRESHOLD_ASSERT
          desc: Assert value of the FromHost programmable full flag
        - range: 6..0
          name: THRESHOLD_NEGATE
          desc: Negate value of the FromHost programmalbe full flag
    - name: TOHOST_FULL_THRESH
      type: W
      bitfield:
        - range: 27..16
          name: THRESHOLD_ASSERT
          desc: Assert value of the ToHost programmable full flag
        - range: 11..0
          name: THRESHOLD_NEGATE
          desc: Negate value of the ToHost programmalbe full flag
    
    - name: BUSY_THRESHOLD_ASSERT
      type: W
      desc: Tohost or Fromhost busy will be asserted in circular DMA mode when the server PC buffer gets full (space below ASSERT threshold)..
      default: 0x6400000
      bitfield:
        - range: 63..0
        
    - name: BUSY_THRESHOLD_NEGATE
      type: W
      desc: Tohost or Fromhost busy will be negated in circular DMA mode when the server PC buffer gets less full (space above NEGATE threshold).
      default: 0x6E00000
      bitfield:
        - range: 63..0

    - name: BUSY_STATUS
      type: R
      bitfield:
        - range: 1
          name: FROMHOST_BUSY
          desc: A fromhost descriptor passed BUSY_THRESHOLD_ASSERT, busy flag set
        - range: 0
          name: TOHOST_BUSY
          desc: A tohost descriptor passed BUSY_THRESHOLD_ASSERT, busy flag set

    - name: PC_PTR_GAP
      type: W
      desc: This is the minimum value that the pc_pointer in a descriptor has to decrease in order to flip the evencycle_pc bit
      default: 0x1000000
      bitfield:
        - range: 63..0

DMA_DESC:
  number: 8
  type: W
  entries:
    - name: DMA_DESC_{index}
      bitfield:
        - range: 127..64
          name: END_ADDRESS
          desc: End Address
        - range: 63..0
          name: START_ADDRESS
          desc: Start Address
    - name: DMA_DESC_{index}a
      bitfield:
        - range: 127..64
          name: SW_POINTER
          desc: Pointer controlled by the software, indicating read or write status for circular DMA
        - range: 12
          name: WRAP_AROUND
          desc: Wrap around
        - range: 11
          name: FROMHOST
          desc: "1: fromHost/ 0: toHost"
        - range: 10..0
          name: NUM_WORDS
          desc: Number of 32 bit words

DMA_DESC_STATUS:
  number: 8
  entries:
    - name: DMA_DESC_STATUS_{index}
      bitfield:
        - range: 66
          name: EVEN_PC
          desc: Even address cycle PC
        - range: 65
          name: EVEN_DMA
          desc: Even address cycle DMA
        - range: 64
          name: DESC_DONE
          desc: Descriptor Done
        - range: 63..0
          name: FW_POINTER
          desc: Pointer controlled by the firmwarre, indicating where the DMA is busy reading or writing


#Bar1 contains the registers dedicated to the Wupper interrupg controller.
#Please only edit registers in Bar2.
#Registers in this group will not be generated with WupperCodeGen
Bar1:
  endpoints: 0,1
  type: W
  entries:
    - ref: INT_VEC
    - name: INT_TAB_ENABLE
      offset: 0x100
      bitfield:
        - range: 7..0
          desc: |
            Interrupt Table enable
            Selectively enable Interrupts

INT_VEC:
  number: 16
  type: W
  entries:
    - name: INT_VEC_{index}
      bitfield:
        - range: 127..96
          name: INT_CTRL
          desc: Interrupt Control
        - range: 95..64
          name: INT_DATA
          desc: Interrupt Data
        - range: 64..0
          name: INT_ADDRESS
          desc: Interrupt Address

#Bar 2 contains application specific registers, used in the example application.
#Registers in this group (and it's referenced subroups) will be generated with
#WupperCodeGen for wupper Firmware, Software and Documentation
Bar2:
  entries:
    - ref: GenericBoardInformation
      offset: 0x0000
    - ref: fee_request 
      offset: 0xa000
    - ref: fee_reply 
      offset: 0xb000
    - ref: gth_status
      offset: 0xc000
    - ref: fee_link_counters 
      offset: 0xd000
    - ref: evt_stat
      offset: 0xe000
    - ref: evt_ctrl
      offset: 0xf000

GenericBoardInformation:
  group: GEN
  desc: Generic Board Information
  endpoints: 0,1
  entries:
    - name: REG_MAP_VERSION
      bitfield:
        - range: 15..0
          value: std_logic_vector(to_unsigned({{ tree.version|version }},16))
          desc: Register Map Version, {{ tree.version }} formatted as {{ tree.version|version|xhex }}

    - name: BOARD_ID_TIMESTAMP
      bitfield:
        - range: 39..0
          value: BUILD_DATETIME
          desc: Board ID Date / Time in BCD format YYMMDDhhmm

    - name: GIT_COMMIT_TIME
      bitfield:
        - range: 39..0
          value: COMMIT_DATETIME
          desc: Board ID GIT Commit time of current revision, Date / Time in BCD format YYMMDDhhmm
          
    - name: GIT_TAG
      bitfield:
        - range: 63..0
          value: GIT_TAG(63 downto 0)
          desc: String containing the current GIT TAG

    - name: GIT_COMMIT_NUMBER
      bitfield:
        - range: 31..0
          value: std_logic_vector(to_unsigned(GIT_COMMIT_NUMBER,32))
          desc: Number of GIT commits after current GIT_TAG
          
    - name: GIT_HASH
      bitfield:
        - range: 31..0
          value: GIT_HASH(159 downto 128)
          desc: Short GIT hash (32 bit)

    - name: STATUS_LEDS
      type: W
      bitfield:
        - range: 7..0
          default: 0xAB
          desc: Board GPIO Leds
    
    - name: DMA_BUSY_STATUS
      type: W
      bitfield:
        - range: any
          type: T
          value: 1
          name: CLEAR_LATCH
          desc: Any write to this register clears TOHOST_BUSY_LATCHED
        - range: 4
          type: W
          name: ENABLE
          desc: Enable the DMA buffer on the server as a source of busy
          default: 0
        - range: 3
          type: R
          name: TOHOST_BUSY_LATCHED
          desc: A tohost descriptor has passed BUSY_THRESHOLD_ASSERT in the past, busy flag was set
          value: (others => tohost_busy_latched_40_s) 
        - range: 0
          type: R
          name: TOHOST_BUSY
          desc: A tohost descriptor passed BUSY_THRESHOLD_ASSERT, busy flag set
          value: (others => tohost_busy_40_s)    
    
    - name: INT_TEST
      offset: 0x0800
      type: W
      value: 1
      bitfield:
        - name: TRIGGER
          type: T
          range: any
          desc: Fire a test MSIx interrupt set in IRQ
        - name: IRQ
          type: W
          range: 3..0
          desc: Set this field to a value equal to the MSIX interrupt to be fired. The write triggers the interrupt immediately.
          
    - name: GENERIC_CONSTANTS
      bitfield:
        - range: 15..8
          name: INTERRUPTS
          value: std_logic_vector(to_unsigned(NUMBER_OF_INTERRUPTS,8))
          desc: Number of Interrupts
        - range: 7..0
          name: DESCRIPTORS
          value: std_logic_vector(to_unsigned(NUMBER_OF_DESCRIPTORS,8))
          desc: Number of Descriptors

    - name: NUM_OF_CHANNELS
      bitfield:
        - range: 7..0
          desc: Number of GBT Channels

    - name: CARD_TYPE
      bitfield:
        - range: 63..0
          value: std_logic_vector(to_unsigned(CARD_TYPE,64))
          desc: |
            Card Type:
              - 709 (0x2c5): VC-709
              - 710 (0x2c6): HTG-710
              - 711 (0x2c7): BNL-711
              - 712 (0x2c8): BNL-712

    - name: OPTO_TRX_NUM
      bitfield:
        - range: 7..0
          desc: Number of optical transceivers in the design

    - name: CR_INTERNAL_LOOPBACK_MODE
      type: R
      bitfield:
        - range: 0
          desc: 1 when Central Router internal loopback mode is enabled
     
    - name: DEBUG_MODE
      type: R
      bitfield:
        - range: 0
          desc: |
            0: SMA X3 is constant 0, SMA X4 is connected to clk40 (output).
            1: Debug port module (SMA X3 and SMA X4) can be controlled using DEBUG_PORT_GBT and DEBUG_PORT_CLK

    - name: FIRMWARE_MODE
      type: R
      bitfield:
        - range: 3..0
          desc: |
            0: GBT mode
            1: FULL mode
            2: LTDB mode (GBT mode with only IC and TTC links)
            3: FEI4 mode
            4: ITK Pixel
            5: ITK Strip
            6: FELIG
            7: FULL mode emulator
                        
    - name: GTREFCLK_SOURCE
      type: R
      bitfield:
        - range: 1..0
          desc: |
            0: Transceiver reference Clock source from Si5345
            1: Transceiver reference Clock source from Si5324
            2: Transceiver reference Clock from internal BUFG (GREFCLK)
                      
    - name: BLOCKSIZE
      type: R
      desc: Number of bytes in a block
      bitfield:
        - range: 15..0
          
    - name: PCIE_ENDPOINT
      type: R
      desc: Indicator of the PCIe endpoint on BNL71x cards with two endpoints. 0 or 1
      bitfield:
        - range: 0
          value: std_logic_vector(to_unsigned(PCIE_ENDPOINT, 1)) 

    - name: SCRATCH_PAD
      type: W
      bitfield:
        - range: 63..0
          default: 0xfeedfaceba5eba11
          desc: Scratch pad register to test register reads and writes

    - name: DMA_TEST
      type: W
      value: 1
      bitfield:
        - name: TRIGGER
          type: T
          range: any
          desc: Trigger DMA data generator 
        - name: LENGTH 
          type: W
          range: 15..0
          desc: Burst length

    - name: LMK_LOCKED 
      type: R
      bitfield:
        - range: 0
          desc: LMK Locked Signal

    - name: PHY_RESET 
      type: W
      bitfield:
        - range: 31..0
          desc: PHY Reset

    - name: SI5345_PLL 
      type: W
      value: 1
      bitfield:
        - name: program 
          type: T
          range: 2 
          desc: i2c program
        - name: nLOL 
          type: R
          range: 1
          desc: Loss of Lock
        - name: i2c_busy 
          type: R
          range: 0
          desc: i2c busy

    - name: fee_stream_enable
      type: W
      bitfield:
        - range: 31..0
          default: 0
          desc: FEE Stream Enable

    - name: dma_packet_chunk_size 
      type: W
      bitfield:
        - range: 9..0
          default: 128 
          desc: DMA Packer Chunk Size (16-bit words)

    - name: DMA_FIFO_FULL_COUNT 
      type: R
      bitfield:
        - range: 31..0 
          desc: DMA toHost FIFO Full Counter 

fee_request:
  group: FEE_REQ
  desc: FEE Request Registers
  endpoints: 0,1
  number: 8
  entries:
    - format_name: fee_request_{index}
      name: fee_request
      type_name: fee_request
      type: W
      value: 1
      bitfield:
        - name: reg_read
          type: T
          value: register_write_data_25_v(49 downto 49)
          range: 49
        - name: reg_write
          type: T
          value: register_write_data_25_v(48 downto 48)
          range: 48
        - name: reg_address 
          type: W
          range: 47..32 
        - name: data_write
          type: W
          range: 31..0

fee_reply:
  name: FEE_REP
  desc: FEE Reply Registers
  endpoints: 0,1
  number: 8
  entries:
    - format_name: fee_reply_{index}
      name: fee_reply 
      type_name: fee_reply 
      type: R
      bitfield:
        - name: rx_ready
          range: 50
        - name: reg_ack
          range: 49
        - name: reg_fail
          range: 48
        - name: reg_address
          range: 47..32 
        - name: data_read
          range: 31..0

fee_link_counters:
  group: FEE_LINK_COUNTERS 
  desc: FEE Link Stat Counters 
  endpoints: 0,1
  number: 8
  entries:
    - format_name: fee_link_block_cnt{index}
      name: fee_link_block_cnt
      type_name: fee_link_block_cnt
      type: R
      bitfield:
        - name: rx_sob 
          range: 63..32
        - name: rx_eob 
          range: 31..0
    - format_name: fee_link_crc_errors{index}
      name: fee_link_crc_errors
      type_name: fee_link_crc_errors
      type: R
      bitfield:
        - name: fifo_full
          range: 47..32
        - name: stream_data 
          range: 31..16
        - name: control_data
          range: 15..0
          
gth_status:
  name: GTH_STATUS 
  desc: GTH STatus Registers
  endpoints: 0
  entries:
    - name: tx_locked 
      type: R
      bitfield:
        - range: 7..0
          desc: TX Locked Status
    - name: rx_locked 
      type: R
      bitfield:
        - range: 7..0
          desc: RX Locked Status
    - name: gtm_recv_clock_freq 
      type: R
      bitfield:
        - range: 31..0
          desc: GTM recovered clock frequency
    - name: gtm_bco 
      type: R
      bitfield:
        - range: 39..0
          desc: BCO from GTM

reset_ctrl:


evt_stat:
  group: EVT_STATUS
  desc: EVT Status Registers
  endpoints: 0,1
  number: 8
  entries:
    - format_name: EVT_FIFO_STATUS_{index}
      name: EVT_FIFO_STATUS
      type_name: EVT_FIFO_STATUS
      type: R
      desc: Number of event word in buffer
      bitfield:
       - range: 31..0

    - format_name: EVT_FIFO_DATA_{index}
      name: EVT_FIFO_DATA
      type_name: EVT_FIFO_DATA
      type: R
      desc: Event data
      bitfield:
        - range: 31..0

evt_ctrl:
  group: EVT_CONTROL
  desc: EVT Control Registers
  endpoints: 0,1
  number: 8
  entries:
    - format_name: EVT_FIFO_RD_{index}
      name: EVT_FIFO_RD
      type_name: EVT_FIFO_RD
      type: W
      value: 0
      bitfield:
        - name: RD
          type: T
          range: any
          desc: Event FIFO read

